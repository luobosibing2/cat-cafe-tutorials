---
name: cross-cat-handoff
description: 当用户提到要把工作交给另一个 AI 时触发，强制执行交接五件套
---

# Core Principle

**交接时必须提供完整的上下文，因为 AI 没有持久记忆。**

AI 在新对话中会忘记之前的所有信息。如果你只说"我改完了"，接手方不知道：
- 你改了什么
- 为什么这样改
- 考虑过哪些方案，为什么放弃

**没有 Why = 接手方无法判断对错 = 低效协作。**

---

## 检查流程

**BEFORE 交接工作:**

1. **CHECK**：是否包含交接五件套？
   - What：具体改动了什么
   - Why：为什么这样做
   - Tradeoff：放弃了什么方案
   - Open Questions：不确定的点
   - Next Action：希望对方做什么

2. **BLOCK**：禁止的交接
   - ❌ "我改完了，帮我 review"
   - ❌ "代码已经 push 了"
   - ❌ "你看看这个 PR"
   - ❌ 只贴代码，没有上下文

3. **PASS**：允许的交接
   - ✅ 完整的交接五件套
   - ✅ 每个部分都有具体内容
   - ✅ Next Action 明确

---

## Block 场景

### 场景 1：只有 What，没有 Why

**User:**
> 把这个交给缅因猫

**❌ 错误的交接:**
> @缅因猫 我改完了三个文件，帮我 review

**问题：** 缅因猫不知道你为什么要改这些文件，无法判断改动是否正确。

---

### 场景 2：交接信息太少

**User:**
> 交接工作

**❌ 错误的交接:**
> @缅因猫 代码 push 了，你看看

**问题：** 缅因猫不知道要看什么，为什么看，要找什么问题。

---

### 场景 3：没有明确期望

**User:**
> 让暹罗猫接手

**❌ 错误的交接:**
> @暹罗猫 UI 部分做好了，你继续

**问题：** 暹罗猫不知道"继续"是指继续做什么（写测试？review？还是开发下一个功能？）。

---

## 通过场景

### 场景 1：完整的交接五件套

**User:**
> 交给缅因猫

**✅ 正确的交接:**
> @缅因猫

## What

我完成了以下改动：
- 修改了 `modeSystem.ts`，新增了 `modeSystemPromptByCat()` 函数
- 修改了 `orchestrator.ts`，调用 `modeSystemPromptByCat()` 解析 prompt
- 新增了 4 个测试用例

## Why

原问题：两只猫收到相同的 prompt，都是正方视角，导致辩论质量差。

修复方案：按 catId 从配置中读取不同的 prompt 模板。

## Tradeoff

放弃的方案：
1. 在数据库存 prompt - 考虑过，但 prompt 会频繁调整，数据库不够灵活
2. 用环境变量 - 不够结构化，难以维护

## Open Questions

1. prompt 模板未来是否需要支持动态参数？
2. 是否需要加 prompt 版本控制？

## Next Action

请 review 这三个文件的改动，确认：
1. prompt 解析逻辑是否正确
2. 是否有边界情况没考虑到
3. 测试覆盖是否充分

---

### 场景 2：技术问题的交接

**User:**
> 交给布偶猫

**✅ 正确的交接:**
> @布偶猫

## What

遇到 Redis 迁移问题：
- 当前接口是同步的，不支持 async/await
- 需要改造成 Promise-based 接口

涉及的文件：`redisClient.ts`

## Why

铲屎官要求把 Redis 从本地迁移到云服务。云服务 SDK 是 Promise-based 的，当前同步接口无法使用。

## Tradeoff

考虑的方案：
1. 完全重写 → 工作量大，风险高
2. 包装器模式 → 已选，改动最小，向后兼容

## Open Questions

1. 是否需要保留旧接口作为 deprecated？
2. 迁移期间如何处理并发的调用？

## Next Action

请评估包装器方案：
1. 设计是否合理
2. 是否有更好的方案
3. 实现建议

---

### 场景 3：持续开发的交接

**User:**
> 让暹罗猫继续

**✅ 正确的交接:**
> @暹罗猫

## What

我已经完成了辩论模式的基础框架：
- 前端：proposal 和 verdict 的 UI 组件
- 后端：辩论状态机、模式切换 API
- 测试：覆盖了 happy path

## Why

铲屎官的需求是让两只猫能辩论，用户可以作为裁判输入 verdict。

## Tradeoff

考虑的方案：
1. WebSocket 实时推送 → 放弃，前端复杂度高
2. HTTP 轮询 → 已选，实现简单，够用了

## Open Questions

1. 暹罗猫更关心 UX，请评估当前交互是否流畅
2. 是否需要动画效果？辩论结束时的反馈如何设计？
3. 移动端适配情况如何？

## Next Action

请从用户体验角度 review：
1. UI 是否直观易懂
2. 交互流程是否流畅
3. 有没有建议改进的地方

---

## 交接五件套详解

### 1. What - 具体改动

**内容：**
- 改动了哪些文件（列出文件路径）
- 新增了什么（函数、类、模块）
- 删除了什么（废弃代码、不再使用）
- 修改了什么（函数签名、逻辑变更）
- 影响范围（哪些模块会受影响）

**为什么重要：**
接手方需要知道从哪里开始看代码，知道改动的影响范围。

**示例：**
```
What:
- 新增文件: modeSystem.ts (200 行)
- 修改文件: orchestrator.ts (修改 15 行)
- 新增函数: modeSystemPromptByCat(), parseModeCommand()
- 影响范围: 所有模式切换逻辑
```

---

### 2. Why - 为什么这样做 ⭐️ 最重要

**内容：**
- 解决了什么问题（Bug、性能、需求）
- 为什么需要这样改（业务原因、技术原因）
- 改动的背景（用户反馈、技术债务、架构调整）
- 期望达到什么效果

**为什么最重要：**
- 没有 Why，接手方无法判断改动是否正确
- 可能提出与原始约束冲突的建议
- 无法理解 tradeoff 是否合理
- 接手方可能误判问题的优先级

**示例：**
```
Why:
原问题：两只猫收到相同的 prompt，都是正方视角，导致辩论质量差。
业务背景：铲屎宋试验后反馈，辩论"一边倒"，没有真正的观点冲突。
修复目标：让每只猫收到不同视角的 prompt，正反分明。
```

---

### 3. Tradeoff - 放弃了什么方案

**内容：**
- 考虑过哪些方案（至少 1-2 个备选方案）
- 为什么放弃其他方案（列出具体的理由）
- 最终选择方案的原因（优势是什么）
- 选择这个方案的代价是什么（会带来什么新问题）

**为什么重要：**
- 避免接手方重复调研
- 理解技术选择的权衡
- 如果后续需要调整，知道为什么当初这样选

**示例：**
```
Tradeoff:
考虑的方案 1: 在数据库存 prompt
  放弃原因: prompt 会频繁调整，数据库更新不够灵活，需要发布

考虑的方案 2: 用环境变量
  放弃原因: 不够结构化，多只猫的 prompt 难以管理，容易搞混

最终选择: 在代码配置文件中定义 prompt 模板
  选择原因: 易于调整，版本可控，支持模板化
  代价: 需要重启服务才能生效（后续可以考虑热加载）
```

---

### 4. Open Questions - 不确定的点

**内容：**
- 还没有确定的问题（待决策）
- 需要进一步调研的点
- 可能的风险
- 需要接手方特别关注的地方
- 已知但暂时搁置的问题

**为什么重要：**
- 知道哪里需要特别关注
- 提前识别风险
- 避免后续踩坑

**示例：**
```
Open Questions:
1. prompt 模板未来是否需要支持动态参数？（比如用户自定义正反方角色）
2. 是否需要加 prompt 版本控制？（A/B 测试、回滚）
3. 多语言支持？目前只有中文 prompt
4. 需要接手方特别关注：模式切换的并发安全性
```

---

### 5. Next Action - 希望对方做什么

**内容：**
- 明确的期望（review？开发？测试？）
- 具体的任务清单
- 需要确认的点（让接手方知道哪些地方需要反馈）
- 优先级（先做后做）
- 时间要求（紧急吗？）

**为什么重要：**
- 避免误解（接手方不知道你想要什么）
- 明确责任分工
- 提高协作效率

**示例：**
```
Next Action:
请 review 这三个文件的改动，确认：
1. [P0] prompt 解析逻辑是否正确？（会不会解析错）
2. [P1] 是否有边界情况没考虑到？（无效 catId、空 prompt）
3. [P2] 测试覆盖是否充分？（至少覆盖：正常解析、异常输入）
4. [P3] 代码风格是否符合规范？

期望：今天下班前能完成 review。
确认方式：review 后请说"可以放行"或指出问题。
```

---

## 核心精神

**交接不是通知，是传递上下文。**

- "我改完了" = 空通知，没有上下文
- "我改了 X，是因为 Y，考虑过 A/B/C 方案" = 传递上下文

**完整的交接 = 接手方能快速理解 = 高效协作。**
